<!DOCTYPE html>
<html>
  <head>
    <meta content="width=device-width, initial-scale=1" name="viewport" />
    <script type="text/javascript" src="./loadCSS.js"></script>
    <script>
      window.$ = window.jQuery = require('./node_modules/jquery/dist/jquery.min.js');
    </script>
    <style>
      .content{
        align-items: unset
      }
      @media  screen and (max-width: 768px){
        .content{
            flex-direction: column
        }
        .content>div{
            width: 100%
        } 
      }
      .viewPass{
        position: absolute;
        top: 42%; 
        right: 5%;
      }
      input[type=number]::-webkit-inner-spin-button, 
input[type=number]::-webkit-outer-spin-button { 
  -webkit-appearance: none; 
  margin: 0; 
}
    </style>
  </head>  
<body class="body_light">  
  <!-- <div w3-include-html="components/header.html"></div>     -->
  <div class="customLoader" id="customLoader" style="display:none">
    <img src="assets/img/ss4_gif.gif">
  </div>
    <div class="flex-row content">
      <div class="width-50">
        <img src="./assets/img/group_image2.png" style="height:100vh;width:100%"/>
      </div>
  
      <div class="width-50">
  
        <div class = "SSform" id = "checkLoginCredentials">
          <form method = "post" id = "login" autocomplete="off" class="form">  
            <!-- <input type="hidden" name="routeParam" value = "login">
            <input type="hidden" name="check" value = "<?php echo $timeParam; ?>">
            <input type="hidden" name="check1" value = "<?php echo $encryptKey; ?>">
            <input type="hidden" name="useEntity" value = "0">
            <input type="hidden" name="fingerprint" id="fingerprint" value="">
            <input type="hidden" name="browser" id="browser" value="">
            <input type="hidden" name="browserVersion" id="browserVersion" value="">
            <input type="hidden" name="browserMajorVersion" id="browserMajorVersion" value="">
            <input type="hidden" name="engine" id="engine" value="">
            <input type="hidden" name="engineVersion" id="engineVersion" value="">
            <input type="hidden" name="os" id="os" value="">
            <input type="hidden" name="osVersion" id="osVersion" value="">
            <input type="hidden" name="device" id="device" value="">
            <input type="hidden" name="deviceType" id="deviceType" value="">
            <input type="hidden" name="deviceVendor" id="deviceVendor" value="">
            <input type="hidden" name="availableResolution" id="availableResolution" value="">
            <input type="hidden" name="colorDepth" id="colorDepth" value=""> -->
           
  
            <div style="margin-bottom:30px">
              <span class="text_20_500_212b36">Get started to dashboard</span>
            </div>
  
            <div style="display: flex;flex-direction: column;">
              <span class="text_16_500_212b36">Mobile Number</span>
              <input type="number" name = "user" id = "user" value="" class="inputStyleSS" placeholder="Enter Mobile Number" required="required">			    
            </div>
            <div style="margin-top:10px; display:flex; flex-direction: column;">
             <span class="text_16_500_212b36">Password</span>
             <span style="position: relative">
               <input type="password" name  = "password" id = "password"  value="" class="width-100 inputStyleSS" placeholder="Enter Password" required="required">
               <img class="viewPass" src="assets/img/visibility_on.png" onclick="showPass()"/>			    
             </span>
            </div>
            <div style="height:30px;width: 100%" class="margin-10">
                <span style="color:#ba1800" id="validMob"></span>
            </div>
            <button type="button" class="btnBlue" id="loginBtn" style="padding: 15px 30px;margin-top:30px" onclick="localLogin()">
              <div class="text_18_500_fff">Login</div>
            </button>
<!--             
            <a href='components/storeDetails.html'>Store Details</a>
            <a href='components/locationDetails.html'>Location Details</a> -->
            <!-- <a href='components/query.html'>Query</a> -->
            <!-- <a href='components/createTable.html'>Create Table</a> -->
            <!-- <a href='inventory/placeNewOrder.html'>Place New Order</a> -->

            <div class="text_20_500_212b36"  style="margin-top:30px;">
                <span style="font-weight: normal">New Here? </span><a href='signup.html' style="font-weight: bold"> Sign Up</a>
            </div>

            <!-- <div class="col-xs-5 col-xs-offset-7 col-sm-5 col-sm-offset-7 col-md-5 col-md-offset-7">
              <a href="#" onclick="forgotPasswordModal()" style="margin-left:4%" class="text_16_500_212b36">Forgot password ?</a>
            </div> -->
          </form>
          
        </div>
  
        <div class = "setForm" style="display:none" id="checkEmailAddr">
          <form method = "post" id = "emailCheck" autocomplete="off" class="form">
              <hgroup>
                
                <!-- <img src="./assets/img/substockist.png" style = "width:50%;height:auto"> -->
            
            </hgroup>
              <span class="instructions">
                Enter the email address you used to register with us and we will send a verification code to help you in resetting your password.
              </span>
  
            <!-- <input type="hidden" name="routeParam" value = "checkEmail">
            <input type="hidden" name="check" value = "<?php echo $timeParam; ?>">
            <input type="hidden" name="check1" value = "<?php echo $encryptKey; ?>">
            <input type="hidden" name="useEntity" value = "0"> -->
  
            <div class="row">
              <div class="col-xs-12 col-sm-12 col-md-12 form-group">
                <input type="text" name = "username" id = "verifyUsername" value="" required="required">
                <label>Username</label>
              </div>
            </div>
  
            <div class="row">
              <div class="col-xs-12 col-sm-12 col-md-12 form-group">
                <input type="text" name = "email" id = "verifyEmail" value="" required="required">
                <label>Email</label>
              </div>
            </div>
  
  
            <div class="row">
              <div class="col-xs-5 col-xs-offset-7 col-sm-5 col-sm-offset-7 col-md-4 col-md-offset-8 form-group">
                <button type="button" class="buttonClass1" onclick = "emailCheck('emailCheck')">INITIATE 
                </button>
                
              </div>
              <div class="col-xs-5 col-xs-offset-7 col-sm-5 col-sm-offset-7 col-md-4 col-md-offset-8 form-group">
                <a href="#" onclick="checkLoginModal()" style="margin-left:11%">Back to login</a>
              </div>
              
            </div>
          </form>
          
        </div>
  
        <div class = "setForm" style="display:none" id = 'checkOtp'>
          <form method = "post" id = "verifyOtp" autocomplete="off" class="form">
              <hgroup>
                
                <!-- <img src="./assets/img/substockist.png" style = "width:50%;height:auto"> -->
            
            </hgroup>
            <span class="instructions">
              Enter the verification code. <a href="#" onclick="emailCheck('emailCheck')" style="color:#2996cc">Resend Code</a>
            </span>
  
            <!-- <input type="hidden" name="routeParam" value = "checkOtp">
            <input type="hidden" name="check" value = "<?php echo $timeParam; ?>">
            <input type="hidden" name="check1" value = "<?php echo $encryptKey; ?>">
            <input type="hidden" name="useEntity" value = "0">
            <input type="hidden" name="email" id = "otpEmail" value = "">
            <input type="hidden" name="username" id = "otpUser" value = ""> -->
  
            <div class="row">
              <div class="col-xs-8 col-sm-8 col-md-8 form-group">
                <input type="text" name = "otp" id = "otp" value="" required="required">
                <label>Code</label>
              </div>
              <div class="col-xs-4 col-sm-4 col-md-4 form-group">
                <button type="button" class="buttonClass1" onclick = "otpCheck('verifyOtp')">VERIFY 
                </button>
                
              </div>
              
            </div>
          </form>
          
        </div>
  
        <div class = "setForm" id = "changePassword" style="display:none">
          <form method = "post" id = "updatePassForgot" autocomplete="off" class="form">
              <hgroup>                
                <!-- <img src="./assets/img/substockist.png" style = "width:50%;height:auto"> -->
            </hgroup>
  
            <!-- <input type="hidden" name="routeParam" value = "updatePassForgot">
            <input type="hidden" name="check" value = "<?php echo $timeParam; ?>">
            <input type="hidden" name="check1" value = "<?php echo $encryptKey; ?>">
            <input type="hidden" name="useEntity" value = "0">
            <input type="hidden" name="email" id = "setPassEmail" value = ""> -->
            <div class="form-group">
              <input type="password" name = "newPassword" id = "newPassword" value="" required="required">
              <label>New Password</label>
            </div>
            <div class="form-group">
              <input type="password" name  = "confirmPassword" id = "confirmPassword" value="" required="required">
              <label>Confirm Password</label>
            </div>
            <button type="button" class="buttonClass" onclick = "updatePass('updatePassForgot')">RESET PASSWORD
            </button>
          </form>
          
        </div>

        <div class = "flex-column SSform" id = "setPasswordForm" style="display:none">
          <form>
            <div id="password_div" class="flex-column margin-20" style="justify-content: space-between">
                <span class="text_16_500_212b36">Password</span>
                <input type="password" name  = "password" id = "setPass"  value="" class="inputStyleSS" placeholder="Enter Password" required="required">			    
            </div>
            <div id="confirm_password_div" class="flex-column margin-20" style="justify-content: space-between">
                <span class="text_16_500_212b36">Confirm Password</span>
                <input type="password" name  = "password" id = "setConfirmPassword"  value="" class="inputStyleSS" placeholder="Confirm Password" required="required">			    
            </div>
            <div style="margin-top: 10px">
                <span id="passwordError" class="text_16_500_de4a49"></span>
            </div>
            <button id="setPasswordButton" type="button" class="btnBlue" style="padding:15px 30px" onclick="setPassword()">
                <div class="text_18_500_fff">Next</div>
            </button> 
          </form>
        </div>
  
      </div>
    </div>

    <div id="messages"></div>

  </body> 
  <script type="text/javascript">
    window.$ = window.jQuery = require('./node_modules/jquery/dist/jquery.min.js');
    const { dialog } = require('electron').remote;
    const sha1 = require('sha1');
    const md5 = require('md5');
    var basepath = process.env.basepath;
    const os = process.env.os;
    let dbPath = basepath;

    if (dbPath.indexOf('app.asar') > -1 || os === 'WINDOWS') {
        dbPath = dbPath.replace('app.asar', '')
    }
    dbPath += '/ssDB';


    const sqlite3 = require('sqlite3').verbose();
    const db = new sqlite3.Database(dbPath);

    var storedPhoneNumber = localStorage.getItem('phoneNumber');
    var loginResponse;

    $(async()=>{
      if(storedPhoneNumber){
        $('#user').val(storedPhoneNumber)
      }
      await backNavigation()
    })   
    backNavigation=()=>{
      $('#imgBack').css('display','none')
      $('#imgForward').css('display','none')
      $('#imgMenu').css('display','none')
      $('#imgBell').css('display','none')
    }

    $(document).on('keypress',function(e) {
    if(e.which == 13) {
      // loginCheck()
      localLogin();
    }
    });


    var mac = require('getmac');
    const axios = require('axios');
    const si = require('systeminformation');

    showPass=()=>{
      passType = $('#password').attr('type')
      console.log(passType)
      if(passType== 'password'){
        $('#password').attr('type','text')
        $('.viewPass').attr('src','assets/img/visibility_on_blue.png')
        // $('.viewPass').attr('style',"position: absolute;top: 38%; right: 5%")
        // $('.viewPass').css('src',.5)
      }
      else{
        $('#password').attr('type','password')
        $('.viewPass').attr('src','assets/img/visibility_on.png')
        // $('.viewPass').attr('style',"position: absolute;top: 42%; right: 5%")
        // $('.viewPass').css('opacity',1)
      }
    }

    async function loginCheck(){

      var serialNumber;
      var username = $('#user').val();
      var password = $('#password').val();
      $( "#validMob" ).text(" ");
      $('#passwordError').text(" ");
    
      if(username.length > 0){
            if(username.length !== 10){
                $( "#validMob" ).text( "Enter Valid Mobile Number!" ).show();
                return false;
            }
            else if(password.length <6){
                $( "#validMob" ).text( "Enter password having atleast 6 Digits " ).show();
                return false;
            }
        }
      else{
          $( "#validMob" ).text( "Please fill mobile number field" ).show();
          return false;
      }

      var permission;

      if(storedPhoneNumber != undefined && storedPhoneNumber != username){
          
        permission = await checkLogoutPermission();

        if(!permission){

          return false;
        }

      }

      mac.getMac(async function(err, macAddress){
      if (err)  throw err;

        serialNumber = macAddress;
        let data = {
          username,
          password,
          serialNumber
        }

        loader(1)
      try{
        var login = await axios.post('http://13.235.5.156/ssapi/public/v1/merchant/loginApp',data) 
        loader(0)
        console.log('login response',login);
      }
      catch(error){
        console.log(error.response)
        loader(0)

        if(error.response == undefined){

          var dialogOptions = {type: 'info', buttons: ['OK'], message: 'Slow internet connectivity'}
          dialog.showMessageBox(dialogOptions, async i => {
              
          }) 
        }
        else{

          $( "#validMob" ).text(error.response.data.message).show();
        }
        
        return false;
      }

      loginResponse = login.data;
      var fingerprint = loginResponse.fingerprint;
      localStorage.setItem('loginResponse',JSON.stringify(loginResponse))
      localStorage.setItem('serialNumber',fingerprint)

      let obj = { 
        storeID:loginResponse.storeList[0].storeID,
        userID:loginResponse.userID,
        serialNumber:loginResponse.fingerprint
      }
      loader(1)
      try{
        var newClient = await axios.post('http://13.235.5.156/ssapi/public/v1/oauth/newClient',obj)
        loader(0)
        console.log('new client response',newClient)
      } 
      catch(error){
        console.log(error.response.data)
        loader(0)
        return false;
      } 
  
      var systemInfo = await si.system()

      obj = {
        grant_type:'client_credentials',
        serialNumber:fingerprint,
        client_id:newClient.data.clientID,
        client_secret:newClient.data.clientSecret,
        deviceSerialNumber:systemInfo.serial,
        manufacturer:systemInfo.manufacturer,
        modelNumber:systemInfo.model
      }
      loader(1)
      try{
        var token = await axios.post('http://13.235.5.156/ssapi/public/oauth/token',obj)
        loader(0)
        console.log('token response',token)
      }
      catch(error){
        console.log(error.response.data)
        loader(0)
        return false;
      }

      localStorage.setItem('clientID',newClient.data.clientID);
      localStorage.setItem('clientSecret',newClient.data.clientSecret)
      localStorage.setItem('access_token',token.data.access_token)

      var dataSynced = localStorage.getItem('dataSynced')
      var isPhoneVerified = loginResponse.isPhoneVerified
      var isPasswordSet = loginResponse.isPasswordSet
      var isLocationSet = loginResponse.isLocationSet
      //window.location.href = 'components/getStarted.html';

      if(storedPhoneNumber == username && dataSynced== 'true'){
          if(isPhoneVerified && isPasswordSet){
            localStorage.setItem('dataSynced',true)
            localStorage.setItem('phoneNumber',username)
            localStorage.setItem('loggedIn',true)
            window.location.href = 'components/dashboard.html';
          }      
      }
      else{

        console.log('permission',permission)
        if(permission){

          // delete tables

          var deleteTables = ['sharedPref','piSummary','poSummary','unipayLedger','creditNotes','stockTransactionSummary','stockRequisitionSummary','orderInformation','updatedOrderInformation','voidOrderInformation','orderPayments'];

          for(let i=0;i<deleteTables.length;i++)
          {
            var query = 'DELETE FROM '+deleteTables[i];

            await new Promise((resolve,reject)=>{

              db.run(query,function(err,data){

                if(err){
                  console.log(err,deleteTables[i])
                }
                else{
                  resolve();
                }
              })

            })

          }
          
        }

        if(isPhoneVerified && isPasswordSet){
          localStorage.setItem('dataSynced',false)
          localStorage.setItem('phoneNumber',username)
          localStorage.setItem('loggedIn',true)
          if(isLocationSet){
            window.location.href = 'components/dataSync.html';
          }
          else{
            window.location.href = 'components/locationDetails.html';
          }
        }
        else if(isPhoneVerified && !isPasswordSet){
          localStorage.setItem('dataSynced',false)
          localStorage.setItem('phoneNumber',username)
          localStorage.setItem('loggedIn',true)
          $('#checkLoginCredentials').css('display','none')
          $('#setPasswordForm').css('display','flex')
        } 
        else if(!isPhoneVerified && !isPasswordSet){
          $( "#validMob" ).text( "Your phone number is not verified, Please Sign up to access the dashboard" ).show();
        }
        else{
          localStorage.setItem('dataSynced',false)
          localStorage.setItem('phoneNumber',username)
          localStorage.setItem('loggedIn',true)
          window.location.href = 'components/getStarted.html';
        }
      }
      
      })
    }

    async function setPassword(){
      let password = $('#setPass').val();
      let confirmPassword = $('#setConfirmPassword').val();
      var username = $('#user').val();
      $( "#validMob" ).text(" ");
      $('#passwordError').text(" ");

      if(password.length < 6 ){

          let error = 'Password length should be minimum 6 characters'
          $('#passwordError').text(error)
          return false;
      }

      if(password !== confirmPassword){

          let error = 'Passwords do not match';
          $('#passwordError').text(error)
          return false;
      }

      let data = {
          password,
          confirmPassword,
          userID:loginResponse.userID,
          mobile:username
      }
      loader(1)
      try{
          var setPasswordResponse = await axios.post('http://13.235.5.156/ssapi/public/v1/merchant/setFirstPassword',data)
          loader(0)
          console.log(setPasswordResponse)
      }
      catch(error){
          console.log(error.response.data)
          loader(0)
      }
      if(setPasswordResponse.data.status){
          window.location.href = 'components/getStarted.html';
      }

      }
   
    async function checkLogoutPermission(){

        var allow = true;

        var orders = await new Promise((resolve,reject)=>{

            db.all(`SELECT * from orderInformation`,function(err,data){

                if(err){
                    console.log(err)
                }
                else{
                    resolve(data)
                }
            })
        })
        
        var stock = await new Promise((resolve,reject)=>{
        
            db.all("SELECT * FROM stockRequisitionSummary", function(err, data){
            
                if(err){
                    console.log(err)
                }
                else{
                    resolve(data)
                }
            })
        })
        
        var stockTransactionSummary = await new Promise((resolve,reject)=>{
        
            db.all("SELECT * FROM stockTransactionSummary", function(err, data){
            
                if(err){
                    console.log(err)
                }
                else{
                    resolve(data)
                }
            })
        })

        for(let i=0;i<orders.length;i++)
        {
            if(orders[i].isSync == 0){

                allow = false;
                break;
            }
        }

        for(let i=0;i<stock.length;i++)
        {
            if(stock[i].isSync == 0){

                allow = false;
                break;
            }
        }

        for(let i=0;i<stockTransactionSummary.length;i++)
        {
            if(stockTransactionSummary[i].isSync == 0){

                allow = false;
                break;
            }
        }

        if(!allow){

            const dialogOptions = {type: 'info', buttons: ['Cancel','OK'], message: 'You have unsynced data which you may loose ! Are you sure you want to continue ?'}
                
            var res = await new Promise((resolve,reject)=>{

                dialog.showMessageBox(dialogOptions, async i => {
                    
                    console.log(i)

                    if(i){
                        resolve(true);
                    }
                    else{
                        resolve(false);
                    }

                })       
            })

            return res;
        }
        else{
            return true;
        }

    }

    async function localLogin(){

      $( "#validMob" ).text(" ");
      $('#passwordError').text(" ");
      var username = $('#user').val();
      var password = $('#password').val();
      var dataSynced = localStorage.getItem('dataSynced');
      
      console.log('username',username)
  
      if(username.length > 0){
            if(username.length !== 10){
                $( "#validMob" ).text( "Enter Valid Mobile Number!" ).show();
                return false;
            }
            else if(password.length <6){
                $( "#validMob" ).text( "Enter password having atleast 6 Digits " ).show();
                return false;
            }
        }
      else{
          $( "#validMob" ).text( "Please fill mobile number field" ).show();
          return false;
      }
      

      if(storedPhoneNumber == undefined || dataSynced == 'false'){

        newLogin();
        return false;
      }

      if(username != storedPhoneNumber){

        $( "#validMob" ).text('Incorrect username').show();
        return false;
      }
      
      var encryptedPassword = sha1(sha1(md5(sha1(md5(password)))));
      var dbPassword = await new Promise((resolve,reject)=>{

        db.get(`SELECT password FROM users WHERE username = ${username}`,function(err,data){

          if(err){
            console.log(err)
          }
          else{
            if(data){
              resolve(data.password)
            }
            else{
              resolve(undefined);
            }
          }
        })

      })

      console.log('password',password)
      console.log('encryptedPassword',encryptedPassword)
      console.log('dbPassword',dbPassword)

      if(encryptedPassword != dbPassword){

        $( "#validMob" ).text('Incorrect password').show();
        return false;
      }

      var isPhoneVerified = localStorage.getItem('isPhoneVerified');
      var isPasswordSet = localStorage.getItem('isPasswordSet');
      var isLocationSet = localStorage.getItem('isLocationSet');

      if(dataSynced == 'true' && isPhoneVerified && isPasswordSet && isLocationSet){

        localStorage.setItem('loggedIn',true)
        window.location.href = 'components/dashboard.html';
      }  

    }

    function newLogin(){

      var serialNumber;
      var username = $('#user').val();
      var password = $('#password').val();

      mac.getMac(async function(err, macAddress){
      
        if (err)  throw err;

        serialNumber = macAddress;
        let data = {
          username,
          password,
          serialNumber
        }

        loader(1)
        try{
          var login = await axios.post('http://13.235.5.156/ssapi/public/v1/merchant/loginApp',data) 
          loader(0)
          console.log('login response',login);
        }
        catch(error){

          console.log(error.response)
          loader(0)
          if(error.response == undefined){

            var dialogOptions = {type: 'info', buttons: ['OK'], message: 'Slow internet connectivity'}
            dialog.showMessageBox(dialogOptions, async i => {
                
            }) 
          }
          else{
            $( "#validMob" ).text(error.response.data.message).show();
          }
          
          return false;
        }

        loginResponse = login.data;
        var fingerprint = loginResponse.fingerprint;
        localStorage.setItem('loginResponse',JSON.stringify(loginResponse))
        localStorage.setItem('serialNumber',fingerprint)

        let obj = { 
          storeID:loginResponse.storeList[0].storeID,
          userID:loginResponse.userID,
          serialNumber:loginResponse.fingerprint
        }
        loader(1)
        try{
          var newClient = await axios.post('http://13.235.5.156/ssapi/public/v1/oauth/newClient',obj)
          loader(0)
          console.log('new client response',newClient)
        } 
        catch(error){
          console.log(error.response.data)
          loader(0)
          return false;
        } 
    
        var systemInfo = await si.system()

        obj = {
          grant_type:'client_credentials',
          serialNumber:fingerprint,
          client_id:newClient.data.clientID,
          client_secret:newClient.data.clientSecret,
          deviceSerialNumber:systemInfo.serial,
          manufacturer:systemInfo.manufacturer,
          modelNumber:systemInfo.model
        }

        loader(1)
        try{
          var token = await axios.post('http://13.235.5.156/ssapi/public/oauth/token',obj)
          loader(0)
          console.log('token response',token)
        }
        catch(error){
          console.log(error.response.data)
          loader(0)
          return false;
        }

        localStorage.setItem('clientID',newClient.data.clientID);
        localStorage.setItem('clientSecret',newClient.data.clientSecret)
        localStorage.setItem('access_token',token.data.access_token)

        var isPhoneVerified = loginResponse.isPhoneVerified;
        var isPasswordSet = loginResponse.isPasswordSet;
        var isLocationSet = loginResponse.isLocationSet;

        localStorage.setItem('isPhoneVerified',isPhoneVerified);
        localStorage.setItem('isPasswordSet',isPasswordSet);
        localStorage.setItem('isLocationSet',isLocationSet);            
        
        if(isPhoneVerified && isPasswordSet){
          localStorage.setItem('dataSynced',false)
          localStorage.setItem('phoneNumber',username)
          localStorage.setItem('loggedIn',true)
          if(isLocationSet){
            window.location.href = 'components/dataSync.html';
          }
          else{
            window.location.href = 'components/locationDetails.html';
          }
        }
        else if(isPhoneVerified && !isPasswordSet){
          localStorage.setItem('dataSynced',false)
          localStorage.setItem('phoneNumber',username)
          localStorage.setItem('loggedIn',true)
          $('#checkLoginCredentials').css('display','none')
          $('#setPasswordForm').css('display','flex')
        } 
        else if(!isPhoneVerified && !isPasswordSet){
          $( "#validMob" ).text( "Your phone number is not verified, Please Sign up to access the dashboard" ).show();
        }
        
      })

    }


    const { ipcRenderer } = require('electron');

    ipcRenderer.on('message', function(event, text) {
  var container = document.getElementById('messages');
  var message = document.createElement('div');
  message.innerHTML = text;
  document.getElementById("messages").innerHTML="";
  container.append(message);
});
    const version = document.getElementById('version');
   
    ipcRenderer.send('app_version');
    ipcRenderer.on('app_version', (event, arg) => {
      console.log("on app_version function calling");
      ipcRenderer.removeAllListeners('app_version');
      version.innerText = 'Version ' + arg.version;
    });

    const notification = document.getElementById('notification'); 
const message = document.getElementById('message');
const restartButton = document.getElementById('restart-button');
ipcRenderer.on('update_available', () => { 
  console.log("update_available is working");
  ipcRenderer.removeAllListeners('update_available');
  message.innerText = 'A new update is available. Downloading now...';
  notification.classList.remove('hidden');
});
ipcRenderer.on('update_downloaded', () => {
  ipcRenderer.removeAllListeners('update_downloaded');
  message.innerText = 'Update Downloaded. It will be installed on restart. Restart now?';
  restartButton.classList.remove('hidden');
  notification.classList.remove('hidden');
});

function closeNotification() {
  notification.classList.add('hidden');
}
function restartApp() {
  ipcRenderer.send('restart_app');
}

  </script>
  <script src="./dist/bundle.js"></script>
  <script type="text/javascript" src="helpers.js"></script>
</html>





